{"remainingRequest":"/Users/guohechuan/code/aurora/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/guohechuan/code/aurora/src/components/MarkDown/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/guohechuan/code/aurora/src/components/MarkDown/index.vue","mtime":1626163653606},{"path":"/Users/guohechuan/code/aurora/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KCmltcG9ydCBtYXJrZWQgZnJvbSAnbWFya2VkJwppbXBvcnQgWm9vbWluZyBmcm9tICd6b29taW5nJwppbXBvcnQgQ2xpcGJvYXJkSlMgZnJvbSAnY2xpcGJvYXJkJwppbXBvcnQga2F0ZXggZnJvbSAna2F0ZXgnCmltcG9ydCBobGpzIGZyb20gJ0AvYXNzZXRzL2xpYi9oaWdobGlnaHQnCmltcG9ydCB7IGZpbGVDRE4sIGhhbmRsZUltZyB9IGZyb20gJ0AvdXRpbHMnCgpmdW5jdGlvbiBtYXRoc0V4cHJlc3Npb24oZXhwcikgewogIGlmIChleHByLm1hdGNoKC9eXCRcJFtcc1xTXSpcJFwkJC8pKSB7CiAgICBleHByID0gZXhwci5zdWJzdHIoMiwgZXhwci5sZW5ndGggLSA0KQogICAgcmV0dXJuIGthdGV4LnJlbmRlclRvU3RyaW5nKGV4cHIsIHsgZGlzcGxheU1vZGU6IHRydWUgfSkKICB9IGVsc2UgaWYgKGV4cHIubWF0Y2goL15cJFtcc1xTXSpcJCQvKSkgewogICAgZXhwciA9IGV4cHIuc3Vic3RyKDEsIGV4cHIubGVuZ3RoIC0gMikKICAgIHJldHVybiBrYXRleC5yZW5kZXJUb1N0cmluZyhleHByLCB7IGlzcGxheU1vZGU6IGZhbHNlIH0pCiAgfQp9Cgpjb25zdCB6b29taW5nID0gbmV3IFpvb21pbmcoewogIGJnT3BhY2l0eTogMC44LAogIHpJbmRleDogMTAwLAp9KQoKbGV0IElNR19JRCA9IDAKbGV0IENPREVfSUQgPSAwCmNvbnN0IENPREVfQ09QWV9MSVNUID0gW10KCmNvbnN0IHJlbmRlcmVyID0gbmV3IG1hcmtlZC5SZW5kZXJlcigpCgpyZW5kZXJlci5oZWFkaW5nID0gZnVuY3Rpb24gKHRleHQsIGxldmVsLCByYXcsIHNsdWdnZXIpIHsKICBjb25zdCBpY29uID0gWydnaWZ0JywgJ3BhZ2VsaW5lcycsICdwaWxjcm93J11bbGV2ZWwgLSAyXQogIHJldHVybiBgPGgke2xldmVsfSBpZD0iaC0ke3NsdWdnZXIuc2x1ZyhyYXcpfSI+PGkgY2xhc3M9Imljb24gaWNvbi0ke2ljb259Ij48L2k+JHt0ZXh0fTwvaCR7bGV2ZWx9PmAKfQoKcmVuZGVyZXIuaW1hZ2UgPSBmdW5jdGlvbiAoaHJlZiwgdGl0bGUsIHRleHQpIHsKICBJTUdfSUQrKwogIGNvbnN0IGlkID0gYGltZy0ke0lNR19JRH1gCiAgY29uc3QgY2RuSHJlZiA9IGZpbGVDRE4oaHJlZikKCiAgY29uc3QgaW1nID0gbmV3IEltYWdlKCkKICBpbWcuc3JjID0gY2RuSHJlZgogIGNvbnN0IGNvbXBlbGV0ZSA9IChpc1N1Y2Nlc3MpID0+IHsKICAgIGNvbnN0IGRvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKQogICAgZG9tLnNyYyA9IGlzU3VjY2VzcyA/IGNkbkhyZWYgOiBocmVmCiAgICBkb20uc3R5bGUub3BhY2l0eSA9IDEKICB9CiAgaW1nLm9ubG9hZCA9ICgpID0+IGNvbXBlbGV0ZSh0cnVlKQogIGltZy5vbmVycm9yID0gKCkgPT4gY29tcGVsZXRlKGZhbHNlKQoKICBjb25zdCB7IHN0eWxlLCBpc0Z1bGwgfSA9IGhhbmRsZUltZyhjZG5IcmVmKQoKICByZXR1cm4gYDxzcGFuIGNsYXNzPSJpbWctYm94ICR7aXNGdWxsID8gJ2Z1bGwnIDogJyd9Ij4KICA8c3BhbiBjbGFzcz0iYmciIHN0eWxlPSIke3N0eWxlfSI+CiAgICA8c3BhbiBjbGFzcz0ibG9hZGluZyI+CiAgICAgIDxzcGFuIGNsYXNzPSJkb3QiPjwvc3Bhbj48c3BhbiBjbGFzcz0iZG90Ij48L3NwYW4+PHNwYW4gY2xhc3M9ImRvdCI+PC9zcGFuPjxzcGFuIGNsYXNzPSJkb3QiPjwvc3Bhbj48c3BhbiBjbGFzcz0iZG90Ij48L3NwYW4+CiAgICA8L3NwYW4+CiAgPC9zcGFuPgogIDxpbWcgaWQ9IiR7aWR9IiBjbGFzcz0iaW1nLXpvb21hYmxlIGN1cnNvciIgc3R5bGU9IiR7c3R5bGV9IiAgbG9hZGluZz0ibGF6eSIgYWx0PSIke3RleHR9IiAvPiR7CiAgICB0ZXh0ID8gYDxzcGFuIGNsYXNzPSJ0aXRsZSI+4petICR7dGV4dH08L3NwYW4+YCA6ICcnCiAgfTwvc3Bhbj5gCn0KCnJlbmRlcmVyLnRhYmxlID0gZnVuY3Rpb24gKGhlYWRlciwgYm9keSkgewogIGlmIChib2R5KSBib2R5ID0gYDx0Ym9keT4ke2JvZHl9PC90Ym9keT5gCiAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJ0YWJsZS13cmFwcGVyIj5cbjx0YWJsZT5cbjx0aGVhZD5cbiR7aGVhZGVyfTwvdGhlYWQ+XG4ke2JvZHl9PC90YWJsZT5cbjwvZGl2PlxuYAp9Cgpjb25zdCByZW5kZXJlckNvZGVzcGFuID0gcmVuZGVyZXIuY29kZXNwYW4KcmVuZGVyZXIuY29kZXNwYW4gPSBmdW5jdGlvbiAodGV4dCkgewogIGNvbnN0IG1hdGggPSBtYXRoc0V4cHJlc3Npb24odGV4dCkKCiAgaWYgKG1hdGgpIHsKICAgIHJldHVybiBtYXRoCiAgfQoKICByZXR1cm4gcmVuZGVyZXJDb2Rlc3Bhbih0ZXh0KQp9Cgpjb25zdCByZW5kZXJlckNvZGUgPSByZW5kZXJlci5jb2RlCnJlbmRlcmVyLmNvZGUgPSBmdW5jdGlvbiBjb2RlKF9jb2RlLCBpbmZvc3RyaW5nLCBlc2NhcGVkKSB7CiAgLy8ga2F0ZXgg5pSv5oyB77yMIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXJrZWRqcy9tYXJrZWQvaXNzdWVzLzE1MzgjaXNzdWVjb21tZW50LTUyNjE4OTU2MQogIGlmICghbGFuZykgewogICAgY29uc3QgbWF0aCA9IG1hdGhzRXhwcmVzc2lvbihfY29kZSkKICAgIGlmIChtYXRoKSB7CiAgICAgIHJldHVybiBtYXRoCiAgICB9CiAgfQoKICBDT0RFX0lEKysKICBjb25zdCBpZCA9IGBjb2RlLSR7Q09ERV9JRH1gCiAgQ09ERV9DT1BZX0xJU1QucHVzaCh7IGlkLCBjb2RlOiBfY29kZSB9KQoKICBjb25zdCBsYW5nID0gKGluZm9zdHJpbmcgfHwgJycpLm1hdGNoKC9cUyovKVswXQoKICBpZiAodGhpcy5vcHRpb25zLmhpZ2hsaWdodCkgewogICAgY29uc3Qgb3V0ID0gdGhpcy5vcHRpb25zLmhpZ2hsaWdodChfY29kZSwgbGFuZykKICAgIGlmIChvdXQgIT0gbnVsbCAmJiBvdXQgIT09IF9jb2RlKSB7CiAgICAgIGVzY2FwZWQgPSB0cnVlCiAgICAgIF9jb2RlID0gb3V0CiAgICB9CiAgfQoKICBpZiAoIWxhbmcpIHsKICAgIHJldHVybiBgPHByZT48Y29kZT4ke19jb2RlfTwvY29kZT48aSBpZD0iJHtpZH0iIGNsYXNzPSJpY29uIGljb24tY2xpcGJvYXJkIGNvZGUtY29weSI+PC9pPjwvcHJlPmAKICB9CgogIHJldHVybiBgPHByZT48Y29kZSBjbGFzcz0iJHsKICAgIHRoaXMub3B0aW9ucy5sYW5nUHJlZml4ICsgbGFuZwogIH0iPiR7X2NvZGV9PC9jb2RlPjxpIGlkPSIke2lkfSIgY2xhc3M9Imljb24gaWNvbi1jbGlwYm9hcmQgY29kZS1jb3B5Ij48L2k+PC9wcmU+XG5gCn0KCm1hcmtlZC5zZXRPcHRpb25zKHsKICByZW5kZXJlciwKICBoaWdobGlnaHQ6IChjb2RlKSA9PiBobGpzLmhpZ2hsaWdodEF1dG8oY29kZSkudmFsdWUsCn0pCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ01hcmtEb3duJywKICBwcm9wczogewogICAgY29udGVudDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnLAogICAgfSwKICAgIHRhcmdldDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBodG1sOiAnJywKICAgICAgY2xpcGJvYXJkczogW10sCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5tYXJrZWQoKQogIH0sCiAgd2F0Y2g6IHsKICAgIGNvbnRlbnQoKSB7CiAgICAgIHRoaXMubWFya2VkKCkKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBtYXJrZWQoKSB7CiAgICAgIHRoaXMuQ09ERV9DT1BZX0xJU1QgPSBbXQogICAgICB0aGlzLmh0bWwgPSBtYXJrZWQodGhpcy5jb250ZW50KQoKICAgICAgLy8g5a+55LqO5Y+q5piv57qv6Kej5p6Q5paH5a2X5LiN6ZyA6KaB5Luj56CB6auY5Lqu5ZKM54Gv566xCiAgICAgIGlmICghdGhpcy50YXJnZXQpIHJldHVybgogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaGxqcy5pbml0TGluZU51bWJlcnNPbkxvYWQoeyB0YXJnZXQ6IHRoaXMudGFyZ2V0IH0pCiAgICAgICAgem9vbWluZy5saXN0ZW4oJy5pbWctem9vbWFibGUnKQogICAgICAgIHRoaXMuYmluZENvZGVDb3B5KCkKICAgICAgfSkKICAgIH0sCiAgICBiaW5kQ29kZUNvcHkoKSB7CiAgICAgIENPREVfQ09QWV9MSVNULmZvckVhY2goKG8pID0+IHsKICAgICAgICBjb25zdCBjbGlwYm9hcmQgPSBuZXcgQ2xpcGJvYXJkSlMoJyMnICsgby5pZCwgewogICAgICAgICAgdGV4dCh0cmlnZ2VyKSB7CiAgICAgICAgICAgIHJldHVybiBvLmNvZGUKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICB0aGlzLmNsaXBib2FyZHMucHVzaChjbGlwYm9hcmQpCiAgICAgIH0pCiAgICB9LAogICAgdW5CaW5kQ29kZUNvcHkoKSB7CiAgICAgIHRoaXMuY2xpcGJvYXJkcy5mb3JFYWNoKChvKSA9PiB7CiAgICAgICAgby5kZXN0cm95KCkKICAgICAgfSkKICAgIH0sCiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgem9vbWluZy5jbG9zZSgpCiAgICB0aGlzLnVuQmluZENvZGVDb3B5KCkKICB9LAp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;AAKA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/MarkDown","sourcesContent":["<template>\n  <div class=\"markdown\" v-html=\"html\"></div>\n</template>\n\n<script>\nimport marked from 'marked'\nimport Zooming from 'zooming'\nimport ClipboardJS from 'clipboard'\nimport katex from 'katex'\nimport hljs from '@/assets/lib/highlight'\nimport { fileCDN, handleImg } from '@/utils'\n\nfunction mathsExpression(expr) {\n  if (expr.match(/^\\$\\$[\\s\\S]*\\$\\$$/)) {\n    expr = expr.substr(2, expr.length - 4)\n    return katex.renderToString(expr, { displayMode: true })\n  } else if (expr.match(/^\\$[\\s\\S]*\\$$/)) {\n    expr = expr.substr(1, expr.length - 2)\n    return katex.renderToString(expr, { isplayMode: false })\n  }\n}\n\nconst zooming = new Zooming({\n  bgOpacity: 0.8,\n  zIndex: 100,\n})\n\nlet IMG_ID = 0\nlet CODE_ID = 0\nconst CODE_COPY_LIST = []\n\nconst renderer = new marked.Renderer()\n\nrenderer.heading = function (text, level, raw, slugger) {\n  const icon = ['gift', 'pagelines', 'pilcrow'][level - 2]\n  return `<h${level} id=\"h-${slugger.slug(raw)}\"><i class=\"icon icon-${icon}\"></i>${text}</h${level}>`\n}\n\nrenderer.image = function (href, title, text) {\n  IMG_ID++\n  const id = `img-${IMG_ID}`\n  const cdnHref = fileCDN(href)\n\n  const img = new Image()\n  img.src = cdnHref\n  const compelete = (isSuccess) => {\n    const dom = document.getElementById(id)\n    dom.src = isSuccess ? cdnHref : href\n    dom.style.opacity = 1\n  }\n  img.onload = () => compelete(true)\n  img.onerror = () => compelete(false)\n\n  const { style, isFull } = handleImg(cdnHref)\n\n  return `<span class=\"img-box ${isFull ? 'full' : ''}\">\n  <span class=\"bg\" style=\"${style}\">\n    <span class=\"loading\">\n      <span class=\"dot\"></span><span class=\"dot\"></span><span class=\"dot\"></span><span class=\"dot\"></span><span class=\"dot\"></span>\n    </span>\n  </span>\n  <img id=\"${id}\" class=\"img-zoomable cursor\" style=\"${style}\"  loading=\"lazy\" alt=\"${text}\" />${\n    text ? `<span class=\"title\">◭ ${text}</span>` : ''\n  }</span>`\n}\n\nrenderer.table = function (header, body) {\n  if (body) body = `<tbody>${body}</tbody>`\n  return `<div class=\"table-wrapper\">\\n<table>\\n<thead>\\n${header}</thead>\\n${body}</table>\\n</div>\\n`\n}\n\nconst rendererCodespan = renderer.codespan\nrenderer.codespan = function (text) {\n  const math = mathsExpression(text)\n\n  if (math) {\n    return math\n  }\n\n  return rendererCodespan(text)\n}\n\nconst rendererCode = renderer.code\nrenderer.code = function code(_code, infostring, escaped) {\n  // katex 支持， https://github.com/markedjs/marked/issues/1538#issuecomment-526189561\n  if (!lang) {\n    const math = mathsExpression(_code)\n    if (math) {\n      return math\n    }\n  }\n\n  CODE_ID++\n  const id = `code-${CODE_ID}`\n  CODE_COPY_LIST.push({ id, code: _code })\n\n  const lang = (infostring || '').match(/\\S*/)[0]\n\n  if (this.options.highlight) {\n    const out = this.options.highlight(_code, lang)\n    if (out != null && out !== _code) {\n      escaped = true\n      _code = out\n    }\n  }\n\n  if (!lang) {\n    return `<pre><code>${_code}</code><i id=\"${id}\" class=\"icon icon-clipboard code-copy\"></i></pre>`\n  }\n\n  return `<pre><code class=\"${\n    this.options.langPrefix + lang\n  }\">${_code}</code><i id=\"${id}\" class=\"icon icon-clipboard code-copy\"></i></pre>\\n`\n}\n\nmarked.setOptions({\n  renderer,\n  highlight: (code) => hljs.highlightAuto(code).value,\n})\n\nexport default {\n  name: 'MarkDown',\n  props: {\n    content: {\n      type: String,\n      default: '',\n    },\n    target: {\n      type: String,\n      default: '',\n    },\n  },\n  data() {\n    return {\n      html: '',\n      clipboards: [],\n    }\n  },\n  created() {\n    this.marked()\n  },\n  watch: {\n    content() {\n      this.marked()\n    },\n  },\n  methods: {\n    marked() {\n      this.CODE_COPY_LIST = []\n      this.html = marked(this.content)\n\n      // 对于只是纯解析文字不需要代码高亮和灯箱\n      if (!this.target) return\n      this.$nextTick(() => {\n        hljs.initLineNumbersOnLoad({ target: this.target })\n        zooming.listen('.img-zoomable')\n        this.bindCodeCopy()\n      })\n    },\n    bindCodeCopy() {\n      CODE_COPY_LIST.forEach((o) => {\n        const clipboard = new ClipboardJS('#' + o.id, {\n          text(trigger) {\n            return o.code\n          },\n        })\n        this.clipboards.push(clipboard)\n      })\n    },\n    unBindCodeCopy() {\n      this.clipboards.forEach((o) => {\n        o.destroy()\n      })\n    },\n  },\n  beforeDestroy() {\n    zooming.close()\n    this.unBindCodeCopy()\n  },\n}\n</script>\n\n<style lang=\"scss\" scope>\n@import './index.scss';\n</style>\n"]}]}