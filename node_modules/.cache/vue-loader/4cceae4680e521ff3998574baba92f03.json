{"remainingRequest":"/Users/guohechuan/code/aurora/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/guohechuan/code/aurora/src/views/Archive/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/guohechuan/code/aurora/src/views/Archive/index.vue","mtime":1626163653611},{"path":"/Users/guohechuan/code/aurora/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/guohechuan/code/aurora/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IExvYWRpbmcgZnJvbSAnQC9jb21wb25lbnRzL0xvYWRpbmcnCmltcG9ydCBRdW90ZSBmcm9tICdAL2NvbXBvbmVudHMvUXVvdGUnCmltcG9ydCBBcmNoaXZlQ2FyZCBmcm9tICdAL2NvbXBvbmVudHMvQXJjaGl2ZUNhcmQnCmltcG9ydCBDb21tZW50IGZyb20gJ0AvY29tcG9uZW50cy9Db21tZW50JwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdBcmNoaXZlJywKICBjb21wb25lbnRzOiB7CiAgICBMb2FkaW5nLAogICAgUXVvdGUsCiAgICBBcmNoaXZlQ2FyZCwKICAgIENvbW1lbnQsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGluaXRDb21tZW50OiBmYWxzZSwKICAgICAgcGFnZTogMCwKICAgICAgcGFnZVNpemU6IDEwLAogICAgICBwb3N0czogW10sCiAgICAgIGxpc3Q6IFtdLAogICAgICB0aW1lczoge30sCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoewogICAgICB0b3RhbENvdW50OiAoc3RhdGUpID0+IHN0YXRlLnRvdGFsQ291bnQsCiAgICB9KSwKICAgIG1heFBhZ2UoKSB7CiAgICAgIHJldHVybiBNYXRoLmNlaWwodGhpcy50b3RhbENvdW50IC8gdGhpcy5wYWdlU2l6ZSkKICAgIH0sCiAgICBpc0Rpc2FibGVkUHJldigpIHsKICAgICAgcmV0dXJuIHRoaXMucGFnZSA8PSAxCiAgICB9LAogICAgaXNEaXNhYmxlZE5leHQoKSB7CiAgICAgIHJldHVybiB0aGlzLnBhZ2UgPj0gdGhpcy5tYXhQYWdlCiAgICB9LAogIH0sCiAgYXN5bmMgY3JlYXRlZCgpIHsKICAgIGlmICghdGhpcy50b3RhbENvdW50KSB7CiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdxdWVyeUFyY2hpdmVzQ291bnQnKQogICAgfQogICAgYXdhaXQgdGhpcy5xdWVyeVBvc3RzKCkKICAgIHRoaXMuaW5pdENvbW1lbnQgPSB0cnVlCiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDojrflj5bmlofnq6DliJfooagKICAgIGFzeW5jIHF1ZXJ5UG9zdHModHlwZSA9ICduZXh0JykgewogICAgICBpZiAodGhpcy5sb2FkaW5nKSByZXR1cm4KICAgICAgY29uc3QgcXVlcnlQYWdlID0gdHlwZSA9PT0gJ3ByZXYnID8gdGhpcy5wYWdlIC0gMSA6IHRoaXMucGFnZSArIDEKICAgICAgdGhpcy5wYWdlID0gcXVlcnlQYWdlCgogICAgICBpZiAodGhpcy5saXN0W3F1ZXJ5UGFnZV0pIHsKICAgICAgICB0aGlzLnNjcm9sbFRvcCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnBvc3RzID0gdGhpcy5saXN0W3F1ZXJ5UGFnZV0KICAgICAgICB9KQogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlCiAgICAgIGNvbnN0IHBvc3RzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3F1ZXJ5UG9zdHMnLCB7CiAgICAgICAgcGFnZTogcXVlcnlQYWdlLAogICAgICAgIHBhZ2VTaXplOiB0aGlzLnBhZ2VTaXplLAogICAgICB9KQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQoKICAgICAgdGhpcy5zY3JvbGxUb3AoKCkgPT4gewogICAgICAgIHRoaXMucG9zdHMgPSBwb3N0cwogICAgICAgIHRoaXMubGlzdFtxdWVyeVBhZ2VdID0gcG9zdHMKICAgICAgfSkKCiAgICAgIC8vIOiOt+WPluaWh+eroOeDreW6pgogICAgICBjb25zdCBpZHMgPSBwb3N0cy5tYXAoKG8pID0+IG8uaWQpCiAgICAgIGNvbnN0IGhvdCA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdxdWVyeUhvdCcsIHsgaWRzIH0pCiAgICAgIHRoaXMudGltZXMgPSB7IC4uLnRoaXMudGltZXMsIC4uLmhvdCB9CiAgICB9LAogICAgLy8g5rua5Yqo5Yiw6aG26YOoCiAgICBzY3JvbGxUb3AoY2IpIHsKICAgICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSkKICAgICAgY29uc3QgZGVsYXlUaW1lID0gdGhpcy4kaXNNb2JpbGUudmFsdWUgPyA4MDAgOiA2MDAKICAgICAgc2V0VGltZW91dChjYiwgZGVsYXlUaW1lKQogICAgfSwKICB9LAp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Archive","sourcesContent":["<template>\n  <div id=\"archive\">\n    <Transition name=\"fade-transform\" mode=\"out-in\">\n      <div class=\"page\" v-if=\"posts.length\">\n        <Quote :quote=\"$config.archiveOpts.qoute\" />\n        <ArchiveCard\n          :posts=\"posts\"\n          :times=\"times\"\n          :loading=\"loading\"\n          :isDisabledPrev=\"isDisabledPrev\"\n          :isDisabledNext=\"isDisabledNext\"\n          @handlePage=\"queryPosts\"\n        />\n      </div>\n      <Loading v-else />\n    </Transition>\n\n    <Comment v-if=\"$config.archiveOpts.enableComment && initComment\" title=\"归档\" />\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport Loading from '@/components/Loading'\nimport Quote from '@/components/Quote'\nimport ArchiveCard from '@/components/ArchiveCard'\nimport Comment from '@/components/Comment'\n\nexport default {\n  name: 'Archive',\n  components: {\n    Loading,\n    Quote,\n    ArchiveCard,\n    Comment,\n  },\n  data() {\n    return {\n      loading: false,\n      initComment: false,\n      page: 0,\n      pageSize: 10,\n      posts: [],\n      list: [],\n      times: {},\n    }\n  },\n  computed: {\n    ...mapState({\n      totalCount: (state) => state.totalCount,\n    }),\n    maxPage() {\n      return Math.ceil(this.totalCount / this.pageSize)\n    },\n    isDisabledPrev() {\n      return this.page <= 1\n    },\n    isDisabledNext() {\n      return this.page >= this.maxPage\n    },\n  },\n  async created() {\n    if (!this.totalCount) {\n      await this.$store.dispatch('queryArchivesCount')\n    }\n    await this.queryPosts()\n    this.initComment = true\n  },\n  methods: {\n    // 获取文章列表\n    async queryPosts(type = 'next') {\n      if (this.loading) return\n      const queryPage = type === 'prev' ? this.page - 1 : this.page + 1\n      this.page = queryPage\n\n      if (this.list[queryPage]) {\n        this.scrollTop(() => {\n          this.posts = this.list[queryPage]\n        })\n        return\n      }\n\n      this.loading = true\n      const posts = await this.$store.dispatch('queryPosts', {\n        page: queryPage,\n        pageSize: this.pageSize,\n      })\n      this.loading = false\n\n      this.scrollTop(() => {\n        this.posts = posts\n        this.list[queryPage] = posts\n      })\n\n      // 获取文章热度\n      const ids = posts.map((o) => o.id)\n      const hot = await this.$store.dispatch('queryHot', { ids })\n      this.times = { ...this.times, ...hot }\n    },\n    // 滚动到顶部\n    scrollTop(cb) {\n      window.scrollTo({ top: 0, behavior: 'smooth' })\n      const delayTime = this.$isMobile.value ? 800 : 600\n      setTimeout(cb, delayTime)\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n"]}]}